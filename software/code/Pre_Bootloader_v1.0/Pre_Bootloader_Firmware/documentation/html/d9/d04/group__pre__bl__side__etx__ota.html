<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MTKATR001 Pre-Bootloader Firmware: Firmware Update module</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MTKATR001 Pre-Bootloader Firmware
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a> &#124;
<a href="#files">Files</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Firmware Update module</div></div>
</div><!--header-->
<div class="contents">

<p>This module provides the functions required to enable the application to be able to install a Firmware Image located at the Flash Memory location address of the Application Firmware (i.e., <a class="el" href="../../d9/d0b/group__default__etx__ota__firmware__update__settings.html#ga069c94a1895276eb4a93cfa097b325fa">ETX_APP_FLASH_ADDR</a> ) into the Flash Memory location address of the Bootloader Firmware (i.e., <a class="el" href="../../d4/d56/group__app__etx__ota__config.html#ga97608ce6dccdee0c508843b8860d7b2f">ETX_BL_FLASH_ADDR</a> ).  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="groups" name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:db/d3d/group__main__etx__ota__config"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d3d/group__main__etx__ota__config.html">ETX OTA Protocol Configuration Files</a></td></tr>
<tr class="memdesc:db/d3d/group__main__etx__ota__config"><td class="mdescLeft">&#160;</td><td class="mdescRight">This module contains both the default and the application ETX OTA Protocol Configuration Files. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:d7/d86/group__firmware__update__config"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d86/group__firmware__update__config.html">Firmware Update Configurations sub-module</a></td></tr>
<tr class="memdesc:d7/d86/group__firmware__update__config"><td class="mdescLeft">&#160;</td><td class="mdescRight">This sub-module provides the functions required to enable the firmware_update to be able to store and retrieve the Firmware Update Configurations in or from our MCU/MPU's Flash Memory respectively. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:d7/d21/firmware__update__config_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d21/firmware__update__config_8h.html">firmware_update_config.h</a></td></tr>
<tr class="memdesc:d7/d21/firmware__update__config_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Header file used by the ETX OTA Protocol to store Firmware Update Configurations in Flash Memory. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ga87e920427dcf2cec9c4d8dd852e5fd9b"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html#ga87e920427dcf2cec9c4d8dd852e5fd9b">ETX_OTA_Status</a> { <br />
&#160;&#160;<a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html#gga87e920427dcf2cec9c4d8dd852e5fd9ba8364d5ecc7294eae3b069f09af9c1373">ETX_OTA_EC_OK</a> = 0U
, <a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html#gga87e920427dcf2cec9c4d8dd852e5fd9ba8c01c2d3994e0329c9829281e49e75f5">ETX_OTA_EC_STOP</a> = 1U
, <a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html#gga87e920427dcf2cec9c4d8dd852e5fd9bad62d2085a4a14f06e47d834c272afcb8">ETX_OTA_EC_NR</a> = 2U
, <a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html#gga87e920427dcf2cec9c4d8dd852e5fd9baf864abe2b916a1a6c94f89afb3f4e8ee">ETX_OTA_EC_NA</a> = 3U
, <br />
&#160;&#160;<a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html#gga87e920427dcf2cec9c4d8dd852e5fd9bac4d81e1c23f4db8f03d3a484a40f211e">ETX_OTA_EC_ERR</a> = 4U
<br />
 }</td></tr>
<tr class="memdesc:ga87e920427dcf2cec9c4d8dd852e5fd9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">ETX OTA Exception codes.  <a href="../../d9/d04/group__pre__bl__side__etx__ota.html#ga87e920427dcf2cec9c4d8dd852e5fd9b">More...</a><br /></td></tr>
<tr class="separator:ga87e920427dcf2cec9c4d8dd852e5fd9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gac473a82d9f8121ae6c5eab1750ef639b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html#ga87e920427dcf2cec9c4d8dd852e5fd9b">ETX_OTA_Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html#gac473a82d9f8121ae6c5eab1750ef639b">install_bl_stored_in_app_fw</a> (<a class="el" href="../../d7/d98/structfirmware__update__config__data__t.html">firmware_update_config_data_t</a> *p_fw_config)</td></tr>
<tr class="memdesc:gac473a82d9f8121ae6c5eab1750ef639b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Attempts to install a Firmware Image located at the Flash Memory location address of the Application Firmware (i.e., <a class="el" href="../../d9/d0b/group__default__etx__ota__firmware__update__settings.html#ga069c94a1895276eb4a93cfa097b325fa">ETX_APP_FLASH_ADDR</a> ) into the Flash Memory location address of the Bootloader Firmware (i.e., <a class="el" href="../../d4/d56/group__app__etx__ota__config.html#ga97608ce6dccdee0c508843b8860d7b2f">ETX_BL_FLASH_ADDR</a> ).  <br /></td></tr>
<tr class="separator:gac473a82d9f8121ae6c5eab1750ef639b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga40532f22429bfc92c49206cb31f63b83"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html#ga87e920427dcf2cec9c4d8dd852e5fd9b">ETX_OTA_Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html#ga40532f22429bfc92c49206cb31f63b83">HAL_ret_handler</a> (HAL_StatusTypeDef HAL_status)</td></tr>
<tr class="memdesc:ga40532f22429bfc92c49206cb31f63b83"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the corresponding <a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html#ga87e920427dcf2cec9c4d8dd852e5fd9b">ETX_OTA_Status</a> value depending on the given HAL_StatusTypeDef value.  <br /></td></tr>
<tr class="separator:ga40532f22429bfc92c49206cb31f63b83"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This module provides the functions required to enable the application to be able to install a Firmware Image located at the Flash Memory location address of the Application Firmware (i.e., <a class="el" href="../../d9/d0b/group__default__etx__ota__firmware__update__settings.html#ga069c94a1895276eb4a93cfa097b325fa">ETX_APP_FLASH_ADDR</a> ) into the Flash Memory location address of the Bootloader Firmware (i.e., <a class="el" href="../../d4/d56/group__app__etx__ota__config.html#ga97608ce6dccdee0c508843b8860d7b2f">ETX_BL_FLASH_ADDR</a> ). </p>
<dl class="section note"><dt>Note</dt><dd>This module expects the Firmware Image to have been previously stored with the ETX OTA Protocol made by Mortrack.</dd></dl>
<p>The way in which this Firmware Image installation process is made is via the ETX OTA Protocol, which is a protocol that serves for the purpose of transferring data from a certain host device to a slave device (i.e., our MCU/MPU) and, in particular, for data whose integrity is considered to be critically important since this protocol prioritizes data transfer reliability over data transfer speed.</p>
<dl class="section note"><dt>Note</dt><dd>Another thing to highlight is that this <a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html">Firmware Update module</a> has included the "stm32f1xx_hal.h" header file in its .c file counter part (i.e., firmware_update_config.c ) to be able to use the UART in this module. However, this header file is specifically meant for the STM32F1 series devices. If yours is from a different type, then you will have to substitute the right one here for your particular STMicroelectronics device. However, if you cant figure out what the name of that header file is, then simply substitute that line of code from this firmware_update_config.c File by: #include "main.h" </dd>
<dd>
<b style="color:orange">IMPORTANT:</b> This <a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html">Firmware Update module</a> , has included the "stm32f1xx_hal.h" header file (via the Source file of this module) to be able to use HAL functions in this module. However, this header file is specifically meant for the STM32F1 series devices. If yours is from a different type, then you will have to substitute the right one here for your particular STMicroelectronics device. However, if you cant figure out what the name of that header file is, then simply substitute that line of code from this hm10_ble by: #include "main.h" </dd>
<dd>
<b style="color:red">WARNING:</b> This Library should be able to perfectly compile with no GCC Optimization Level (i.e., GCC "O0" Optimization Level). However, If you were to compile a certain project that uses this Library with a certain GCC Optimization Level, then it is very likely that this Library will not work. The reason for this does not lie in this actual Library, but in the HAL Library of the STMicroelectronics Team. In particular, this gives place in the HAL_FLASH_Unlock function, which requires to be executed exactly as how the STMicroelectronics Team coded it, which does not happen whenever you Optimize that code. Therefore, one solution for this problem is to tell the GCC Compiler not to optimize the code of the HAL_FLASH_Unlock function. One way to do this is by using the Pragma Tags as in the following example:<br  />
 <div class="fragment"><div class="line"><span class="preprocessor">#pragma GCC push_options</span></div>
<div class="line"><span class="preprocessor">#pragma GCC optimize (&quot;O0&quot;</span>)</div>
<div class="line">HAL_StatusTypeDef HAL_FLASH_Unlock(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Code of the HAL_FLASH_Unlock() Function here (I did not pasted its code here for simplicity reasons).</span></div>
<div class="line">}</div>
<div class="line"><span class="preprocessor">#pragma GCC pop_options</span></div>
</div><!-- fragment --> where these Pragma tags will tell the GCC compiler not to Optimize all the code inside "#pragma GCC push_options" and "#pragma GCC pop_options" Tags.<br  />
 However, this will only work if your GCC is v4.4 or higher. Therefore, if your GCC has a lower version, then use the following method to tell the GCC Compiler not to optimize that code: <div class="fragment"><div class="line">HAL_StatusTypeDef __attribute__((optimize(<span class="stringliteral">&quot;O0&quot;</span>))) HAL_FLASH_Unlock(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Code of the HAL_FLASH_Unlock() Function here (I did not pasted its code here for simplicity reasons).</span></div>
<div class="line">}</div>
</div><!-- fragment --> <b style="color:orange">Whenever any of these solutions is implemented, it is very important to</b> make sure to rewrite the HAL Library of the STMicroelectronics Team with the chosen solution after each time you re-configure your project via the STM32CubeMx App since it is likely for this App to rewrite the HAL Library as it originally was released by the STMicroelectronics Team, which as previously stated, it does not include any of the proposed solutions.</dd></dl>
<dl class="section author"><dt>Author</dt><dd>Cesar Miranda Meza (<a href="#" onclick="location.href='mai'+'lto:'+'cmi'+'ra'+'nda'+'me'+'za3'+'@h'+'otm'+'ai'+'l.c'+'om'; return false;">cmira<span class="obfuscator">.nosp@m.</span>ndam<span class="obfuscator">.nosp@m.</span>eza3@<span class="obfuscator">.nosp@m.</span>hotm<span class="obfuscator">.nosp@m.</span>ail.c<span class="obfuscator">.nosp@m.</span>om</a>) </dd>
<dd>
EmbeTronicX (<a href="https://github.com/Embetronicx/STM32-Bootloader/tree/ETX_Bootloader_3.0">STM32-Bootloader GitHub Repository under ETX_Bootloader_3.0 branch</a>) </dd></dl>
<dl class="section date"><dt>Date</dt><dd>November 18, 2023. </dd>
<dd>
LAST UPDATE: February 10, 2024. </dd></dl>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="ga87e920427dcf2cec9c4d8dd852e5fd9b" name="ga87e920427dcf2cec9c4d8dd852e5fd9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga87e920427dcf2cec9c4d8dd852e5fd9b">&#9670;&#160;</a></span>ETX_OTA_Status</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html#ga87e920427dcf2cec9c4d8dd852e5fd9b">ETX_OTA_Status</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ETX OTA Exception codes. </p>
<p>These Exception Codes are returned by the functions of the pre_bl_side_firmware_update module to indicate the resulting status of having executed the process contained in each of those functions. For example, to indicate that the process executed by a certain function was successful or that it has failed. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="gga87e920427dcf2cec9c4d8dd852e5fd9ba8364d5ecc7294eae3b069f09af9c1373" name="gga87e920427dcf2cec9c4d8dd852e5fd9ba8364d5ecc7294eae3b069f09af9c1373"></a>ETX_OTA_EC_OK&#160;</td><td class="fielddoc"><p>ETX OTA Protocol was successful. </p>
<dl class="section note"><dt>Note</dt><dd>The code from the <a class="el" href="../../d7/d86/group__firmware__update__config.html#ga0b71ba3eaef4150dbdeb879583392f34">HAL_ret_handler</a> function contemplates that this value will match the one given for <code>HAL_OK</code> from HAL_StatusTypeDef . </dd></dl>
</td></tr>
<tr><td class="fieldname"><a id="gga87e920427dcf2cec9c4d8dd852e5fd9ba8c01c2d3994e0329c9829281e49e75f5" name="gga87e920427dcf2cec9c4d8dd852e5fd9ba8c01c2d3994e0329c9829281e49e75f5"></a>ETX_OTA_EC_STOP&#160;</td><td class="fielddoc"><p>ETX OTA Protocol process or transaction has been stopped. </p>
</td></tr>
<tr><td class="fieldname"><a id="gga87e920427dcf2cec9c4d8dd852e5fd9bad62d2085a4a14f06e47d834c272afcb8" name="gga87e920427dcf2cec9c4d8dd852e5fd9bad62d2085a4a14f06e47d834c272afcb8"></a>ETX_OTA_EC_NR&#160;</td><td class="fielddoc"><p>ETX OTA Protocol has concluded with no response from Host. </p>
</td></tr>
<tr><td class="fieldname"><a id="gga87e920427dcf2cec9c4d8dd852e5fd9baf864abe2b916a1a6c94f89afb3f4e8ee" name="gga87e920427dcf2cec9c4d8dd852e5fd9baf864abe2b916a1a6c94f89afb3f4e8ee"></a>ETX_OTA_EC_NA&#160;</td><td class="fielddoc"><p>ETX OTA Payload received or to be received Not Applicable. </p>
</td></tr>
<tr><td class="fieldname"><a id="gga87e920427dcf2cec9c4d8dd852e5fd9bac4d81e1c23f4db8f03d3a484a40f211e" name="gga87e920427dcf2cec9c4d8dd852e5fd9bac4d81e1c23f4db8f03d3a484a40f211e"></a>ETX_OTA_EC_ERR&#160;</td><td class="fielddoc"><p>ETX OTA Protocol has failed. </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga40532f22429bfc92c49206cb31f63b83" name="ga40532f22429bfc92c49206cb31f63b83"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga40532f22429bfc92c49206cb31f63b83">&#9670;&#160;</a></span>HAL_ret_handler()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html#ga87e920427dcf2cec9c4d8dd852e5fd9b">ETX_OTA_Status</a> HAL_ret_handler </td>
          <td>(</td>
          <td class="paramtype">HAL_StatusTypeDef&#160;</td>
          <td class="paramname"><em>HAL_status</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets the corresponding <a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html#ga87e920427dcf2cec9c4d8dd852e5fd9b">ETX_OTA_Status</a> value depending on the given HAL_StatusTypeDef value. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">HAL_status</td><td>HAL Status value (see HAL_StatusTypeDef ) that wants to be converted into its equivalent of a <a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html#ga87e920427dcf2cec9c4d8dd852e5fd9b">ETX_OTA_Status</a> value.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ETX_OTA_EC_NR</td><td>if <code>HAL_status</code> param equals <code>HAL_BUSY</code> or <code>ETX_CUSTOM_HAL_TIMEOUT</code> . </td></tr>
    <tr><td class="paramname">ETX_OTA_EC_ERR</td><td>if <code>HAL_status</code> param equals <code>HAL_ERROR</code> . </td></tr>
    <tr><td class="paramname">HAL_status</td><td>param otherwise.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>For more details on the returned values listed, see <a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html#ga87e920427dcf2cec9c4d8dd852e5fd9b">ETX_OTA_Status</a> and HAL_StatusTypeDef .</dd></dl>
<dl class="section author"><dt>Author</dt><dd>César Miranda Meza (<a href="#" onclick="location.href='mai'+'lto:'+'cmi'+'ra'+'nda'+'me'+'za3'+'@h'+'otm'+'ai'+'l.c'+'om'; return false;">cmira<span class="obfuscator">.nosp@m.</span>ndam<span class="obfuscator">.nosp@m.</span>eza3@<span class="obfuscator">.nosp@m.</span>hotm<span class="obfuscator">.nosp@m.</span>ail.c<span class="obfuscator">.nosp@m.</span>om</a>) </dd></dl>
<dl class="section date"><dt>Date</dt><dd>September 26, 2023. </dd></dl>

</div>
</div>
<a id="gac473a82d9f8121ae6c5eab1750ef639b" name="gac473a82d9f8121ae6c5eab1750ef639b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac473a82d9f8121ae6c5eab1750ef639b">&#9670;&#160;</a></span>install_bl_stored_in_app_fw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html#ga87e920427dcf2cec9c4d8dd852e5fd9b">ETX_OTA_Status</a> install_bl_stored_in_app_fw </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d7/d98/structfirmware__update__config__data__t.html">firmware_update_config_data_t</a> *&#160;</td>
          <td class="paramname"><em>p_fw_config</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Attempts to install a Firmware Image located at the Flash Memory location address of the Application Firmware (i.e., <a class="el" href="../../d9/d0b/group__default__etx__ota__firmware__update__settings.html#ga069c94a1895276eb4a93cfa097b325fa">ETX_APP_FLASH_ADDR</a> ) into the Flash Memory location address of the Bootloader Firmware (i.e., <a class="el" href="../../d4/d56/group__app__etx__ota__config.html#ga97608ce6dccdee0c508843b8860d7b2f">ETX_BL_FLASH_ADDR</a> ). </p>
<p>This function will first check if the size in bytes of the Firmware Image located at the Flash Memory location address of the Application firmware (i.e., <a class="el" href="../../d9/d0b/group__default__etx__ota__firmware__update__settings.html#ga069c94a1895276eb4a93cfa097b325fa">ETX_APP_FLASH_ADDR</a> ) is perfectly divisible by 4 bytes. Only in the case that this is true, will then this function install that Firmware Image. Otherwise, this function will terminate.</p>
<p>Also, in the case that the Firmware Image is successfully installed, then this function will update the Configuration Settings from the <a class="el" href="../../d7/d86/group__firmware__update__config.html">Firmware Update Configurations sub-module</a> correspondingly and will persist them into its designated Flash Memory (<a class="el" href="../../d7/d98/structfirmware__update__config__data__t.html#a06fb1d74a2c32b7899a246fba90a16c8">firmware_update_config_data_t::BL_fw_size</a> , <a class="el" href="../../d7/d98/structfirmware__update__config__data__t.html#ad25006aadd381274af3fedea1a3b3c3d">firmware_update_config_data_t::BL_fw_rec_crc</a> and <a class="el" href="../../d7/d98/structfirmware__update__config__data__t.html#a31a2cbb6ec93e4e7b8d0afc5f1716eda">firmware_update_config_data_t::is_bl_fw_install_pending</a> will be updated only).</p>
<dl class="section note"><dt>Note</dt><dd>This function expects the implementer to have correctly previously validated that the Firmware Image located at the Flash Memory location address of the Application Firmware (i.e., <a class="el" href="../../d9/d0b/group__default__etx__ota__firmware__update__settings.html#ga069c94a1895276eb4a93cfa097b325fa">ETX_APP_FLASH_ADDR</a> ) corresponds to a Bootloader Firmware Image. If that image ends up not being a Bootloader Firmware Image type, then our MCU/MPU's program/software will most probably not work.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_fw_config</td><td>Pointer to the struct that should already contain the latest data of the <a class="el" href="../../d7/d86/group__firmware__update__config.html">Firmware Update Configurations sub-module</a> .</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ETX_OTA_EC_OK</td><td>if the Firmware Image located at the Flash Memory location address of the Application Firmware (i.e., <a class="el" href="../../d9/d0b/group__default__etx__ota__firmware__update__settings.html#ga069c94a1895276eb4a93cfa097b325fa">ETX_APP_FLASH_ADDR</a> ) is correctly installed into the Flash Memory location address of the Bootlaoder Firmware (i.e., <a class="el" href="../../d4/d56/group__app__etx__ota__config.html#ga97608ce6dccdee0c508843b8860d7b2f">ETX_BL_FLASH_ADDR</a> ). </td></tr>
    <tr><td class="paramname">ETX_OTA_EC_NR</td><td>if there was no response from the HAL of our MCU/MPU whenever either attempting to unlock/lock the HAL FLASH or; to erase/write in the Flash Memory designated to the Bootloader Firmware Image of our MCU/MPU. </td></tr>
    <tr><td class="paramname">ETX_OTA_EC_ERR</td><td>otherwise.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>César Miranda Meza (<a href="#" onclick="location.href='mai'+'lto:'+'cmi'+'ra'+'nda'+'me'+'za3'+'@h'+'otm'+'ai'+'l.c'+'om'; return false;">cmira<span class="obfuscator">.nosp@m.</span>ndam<span class="obfuscator">.nosp@m.</span>eza3@<span class="obfuscator">.nosp@m.</span>hotm<span class="obfuscator">.nosp@m.</span>ail.c<span class="obfuscator">.nosp@m.</span>om</a>) </dd></dl>
<dl class="section date"><dt>Date</dt><dd>November 18, 2023. </dd></dl>
<p><b>Local variable ret:</b> Return value of a <a class="el" href="../../d9/d04/group__pre__bl__side__etx__ota.html#ga87e920427dcf2cec9c4d8dd852e5fd9b">ETX_OTA_Status</a> function function type.</p>
<p><b>Local variable bytes_flashed:</b> Indicator of how many bytes of the identified Bootloader Firmware Image pending to be installed, if any, have been written into the designated Flash Memory of the Bootloader Firmware.</p>
<p><b>Local variable p_data:</b> Pointer to the data at which a Bootloader Firmware Image pending to be installed should be located at but in <code>uint32_t</code> Type.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
